---
title: Prepr CMS & Astro
description: Add content to your Astro project using Prepr as a CMS
type: cms
service: Prepr CMS
stub: true
i18nReady: true
---
import FileTree from '~/components/FileTree.astro'
import PackageManagerTabs from '~/components/tabs/PackageManagerTabs.astro'

[Prepr CMS](https://www.prepr.io/), is a headless CMS with built-in personalization.

## Integrating with Astro

In this section, connect Prepr to an Astro project to get data from Prepr CMS.

### Prerequisites

To get started, you'll need the following:

- [A new Astro project](https://docs.astro.build/en/install/auto/)
- [A free Prepr account](https://signup.prepr.io/)
- [A Prepr environment with demo data](https://docs.prepr.io/account/set-up-environments#create-an-envirntonment)

### Setting up credentials

To add the Prepr endpoint to your Astro project, create a `.env file` in the root of your project with the following variable:

```ini title=".env"
PREPR_ENDPOINT=YOUR_PREPR_API_URL
```

Get `YOUR_PREPR_API_URL` value from your Prepr account:
1. Go to  **Settings > Access tokens** to view all the access tokens.
2. Copy the *API URL* value from the *GraphQL Production* access token to only retrieve published content items.

![Prepr access tokens](https://assets-site.prepr.io//6jouln4xi3wp-default-access-tokens.png)

### Configuring the Prepr endpoint

Configure the Prepr endpoint in a new file called `prepr.js` in a new `lib` folder in the `src`:

```js title=“src/lib/prepr.js”

export async function Prepr(query, variables) {
    const response = await fetch(import.meta.env.PREPR_ENDPOINT, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ query, variables }),
    })
    return response
}
```
Your root directory should now include these **new files**:

<FileTree title="Project Structure">
- src/
- **.env**
- astro.config.mjs
- package.json
    - lib/
        - **prepr.js**
</FileTree>

Update the astro config file `astro.config.mjs` with the code below to use server-side rendering. Check out the [Rendering strategies in Prepr docs](https://docs.prepr.io/connecting-front-end-apps/rendering-strategies) for more details.

```js title=“astro.config.mjs”

import { defineConfig } from 'astro/config';

// https://astro.build/config
export default defineConfig({

    // Set up SSR
    output: 'server'
});
```

### Fetching data

Now that your app is connected to Prepr, you can fetch some data from Prepr.

First, add a GraphQL query to get blog articles:
1. Create a `queries` folder in the `src` folder and create a file named `get-articles.js`.
2. Add the following query to this file to retrieve all articles:

```js title=“src/queries/get-articles.js”

const GetArticles = `
query {
    Articles {
        items {
            _id
            _slug
            title
        }
    }
}
`

export default GetArticles
```

Now that the query has been added, fetch the articles from Prepr and display them in the app.

Go to the `src/pages` folder and update the `index.astro` file to execute the query and display the list of articles:

```astro title=“src/pages/index.astro”

---
import Layout from '../layouts/Layout.astro';
import {Prepr} from '../lib/prepr.js';
import GetArticles from '../queries/get-articles.js';

const response = await Prepr(GetArticles)
const { data } = await response.json()
const articles = data.Articles
---

<Layout title="My blog site">
    <h1>
        My blog site
    </h1>
  <!-- Display the retrieved list of articles -->
    <ul>
        {
            articles.items.map((post) => (
                <li>
                    {post.title}
                </li>
            ))
        }
    </ul>
</Layout>
```

Now when you view the website on your localhost, you'll see something like the image below.

![blog article list](https://assets-site.prepr.io//770picl832e3-screenshot-2023-05-10-at-105008.png)


Now that we have a list of articles, let's expand this example into a full blog where every item's link lets you view the entire blog article.

### Retrieving content item details

So far, you've fetched multiple content items, but to create a fully working blog you also need to be able to fetch single content items. Once you have the list of articles in your overview page, add links to them. This enables a visitor to open a detailed article page.
Update the `index.astro` file to include a link on each article title as shown in the code below.

```astro title=“src/pages/index.astro” ins="<a href={post._slug}>{post.title}</a>" 

---
import Layout from '../layouts/Layout.astro';
import {Prepr} from '../lib/prepr.js';
import GetArticles from '../queries/get-articles.js';

const response = await Prepr(GetArticles)
const { data } = await response.json()
const articles = data.Articles
---

<Layout title="Welcome to Astro.">
    <h1>
        My blog site
    </h1>
    <ul>
        {
            articles.items.map((post) => (
                <li>
           <!-- Add links that reference the article slug -->
                    <a href={post._slug}>{post.title}</a>
                </li>
            ))
        }
    </ul>
</Layout>
```

Now when you view the app, each article has its own link. Continue with the next step to fetch the article details.
Add another query to fetch a specific article by its slug and make this page visible when a visitor clicks an article link.
1. Create a file called `get-article-by-slug.js` in the `queries` folder and add the following query to this file to query a specific article by its slug:

```js title=“src/lib/queries/get-article-by-slug.js”

const GetArticleBySlug = `
query ($slug: String) {
   Article (slug: $slug) {
     _id
     title
     content {
       __typename
       ... on Text {
         body
         text
       }
       ... on Assets {
         items {
           url
         }
       }
     }
   }
}`

export default GetArticleBySlug
```
Now that the query is added, fetch the individual article by its slug. Fetch the article title and the article content.

:::tip
You can create and [test GraphQL queries](https://docs.prepr.io/reference/graphql/v1/test-queries) using the [Apollo explorer](https://studio.apollographql.com/sandbox/explorer) from Prepr. Open the API Explorer from the *Article* content item page in Prepr or the access token page.
The Article content is stored in a *Dynamic content field*. Check out the GraphQL docs for more details on [how to fetch the data within this field](https://docs.prepr.io/reference/graphql/v1/schema-field-types-dynamic-content-field).
:::


2. Go to the `src/pages` folder and create a file called `[…slug].astro` file with the following code to execute the query that you just created and display the retrieved article:

```astro title=“src/pages/[...slug].astro”

---
import Layout from '../layouts/Layout.astro';
import {Prepr} from '../lib/prepr.js';
import GetArticleBySlug from '../queries/get-article-by-slug.js';

const { slug } = Astro.params;
const response = await Prepr(GetArticleBySlug, {slug})
const { data } = await response.json()
const article = data.Article
---

<Layout title={article.title}>
    <main>
        <h1>{article.title}</h1>

        {
            article.content.map((content) => (
            <div>

                {
                    content.__typename === "Assets" &&
                    <img src={content.items[0].url} width="300" height="250"/>
                }

                {
                    content.__typename === 'Text' &&
                    <div set:html={content.body}></div>
                }
            </div>
            ))
        }
    </main>
</Layout>
```

Your root directory should include these **new files**:

<FileTree title="Project Structure">
- Directory
- src/
    - .env
    - astro.config.mjs
    - package.json
    - lib/
        - prepr.js
        - **queries**/
          - **get-articles.js**
          - **get-article-by-slug.js**
    - pages/
      - index.astro
      - **[…slug].astro**
</FileTree>

Now, when you view your site, click an article to open the article detail page like in the image below.

![blog article detail]((https://assets-site.prepr.io//507hx87v7wkw-screenshot-2023-05-11-at-162824.png)

Congratulations! You've successfully integrated an Astro project with Prepr for a simple blog.

## Official Resources

- Follow the [Prepr CMS Astro quickstart](https://github.com/preprio/astro-quick-start) guide to make a simple blog with Astro and Prepr CMS. 
- Check out the [Connecting Prepr CMS to Astro](https://docs.prepr.io/connecting-front-end-apps/astro) for an overview of Astro and Prepr CMS resources


